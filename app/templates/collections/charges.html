{% extends 'base.html' %}

{% block title %}Minhas Dívidas{% endblock %}

{% block content %}

<div class="max-w-5xl mx-auto mt-10 p-6 bg-white rounded-xl shadow">
  <h2 class="text-3xl font-bold mb-6 text-gray-800">Minhas Dívidas</h2>

  <div id="charges-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    <!-- Cards de dívidas inseridos via JS aqui -->
  </div>
</div>

<script>
const token = localStorage.getItem('authToken');

async function fetchCharges() {
  const url = '/api/charges/';
  const response = await fetch(url, {
    headers: { 'Authorization': 'Token ' + token }
  });

  if (response.ok) {
    const charges = await response.json();
    renderCharges(charges);
  } else {
    alert('Erro ao carregar dívidas');
  }
}

function statusClass(status) {
  switch(status.toLowerCase()) {
    case 'paid':
      return 'text-green-600 bg-green-100';
    case 'pending':
    case 'cancelled':
      return 'text-red-600 bg-red-100';
    default:
      return 'text-gray-600 bg-gray-100';
  }
}

function renderCharges(charges) {
  const container = document.getElementById('charges-container');
  container.innerHTML = '';

  if (charges.length === 0) {
    container.innerHTML = '<p class="col-span-full text-center text-gray-500 text-lg">Nenhuma dívida encontrada.</p>';
    return;
  }

  charges.forEach(c => {
    const card = document.createElement('div');
    card.className = "bg-white rounded-lg shadow-md p-5 hover:shadow-lg transition cursor-pointer flex flex-col justify-between";

    card.innerHTML = `
      <div>
        <h3 class="text-xl font-semibold mb-2 text-gray-800">${c.description}</h3>
        <p class="text-gray-700 mb-1"><strong>Devedor:</strong> ${c.name}</p>
        <p class="text-gray-700 mb-1"><strong>Telefone:</strong> ${c.phone}</p>
        <p class="text-gray-700 mb-1"><strong>Valor:</strong> R$ ${parseFloat(c.total_amount).toFixed(2)}</p>
        <!--
        <p class="mb-2">
          <strong>Vencimento:</strong> ${c.due_date}
        </p>
        <p class="mb-2">
          <strong>Parcelas:</strong> ${c.installment_count}
        </p>
        -->
        <span class="inline-block px-3 py-1 rounded-full font-semibold ${statusClass(c.status)}">
          ${c.status}
        </span>
      </div>
      <div class="mt-4">
        <a href="/charge_details/${c.id}/" class="block text-center bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded transition">
          Ver Detalhes
        </a>
      </div>
    `;

    container.appendChild(card);
  });
}

// Inicializa: carrega todas as dívidas
fetchCharges();
</script>

{% endblock %}
