{% extends 'base_public.html' %}

{% block title %}Recuperar senha{% endblock %}

{% block content %}
<div class="max-w-md mx-auto mt-10 p-6 bg-white rounded-xl shadow">
  <h2 class="text-2xl font-bold mb-4">Recuperar senha</h2>
  <form id="password-reset-form">
    <label for="email" class="block mb-2">Email cadastrado</label>
    <input type="text" id="email" name="email" class="border p-2 w-full mb-4 rounded" required>
    <button type="submit" class="w-full bg-[#1980e6] text-white py-2 rounded">Enviar link</button>
  </form>
  <div id="message" class="mt-4 text-center text-green-600"></div>
</div>

<script>document.getElementById('password-reset-form').addEventListener('submit', async function(e) {
    e.preventDefault();

    const email = document.getElementById('email').value;

    const res = await fetch('/auth/users/reset_password/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email })
    });

    const msgEl = document.getElementById('message');

    if (res.ok) {
        msgEl.textContent = 'Link de recuperação enviado! Verifique seu email.';
    } else {
        const data = await res.json().catch(() => ({}));
        console.log('Erro reset_password:', data);
        msgEl.textContent = 'Erro ao enviar link. ' + (data.email ? data.email.join(', ') : 'Confirme o email.');
    }
});

</script>
{% endblock %}
