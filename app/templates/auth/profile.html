{% extends 'base.html' %}

{% block title %}Perfil{% endblock %}

{% block content %}

<div class="min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8" style="font-family: Inter, 'Noto Sans', sans-serif;">
  <div class="max-w-3xl w-full space-y-8 p-8 bg-white rounded-xl shadow-lg">
    <h2 class="text-3xl font-extrabold text-center text-gray-900 mb-6">Meu Perfil</h2>

    <div id="profile-details" class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-4 text-gray-700 text-base">
      <!-- Dados inseridos via JS -->
    </div>

    <div class="mt-8 flex justify-center">
      <a href="/edit_profile/" class="inline-block px-8 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-md shadow transition">
        Editar Perfil
      </a>
    </div>
  </div>
</div>

<script>
const token = localStorage.getItem('authToken');

async function fetchProfile() {
    const response = await fetch('/auth/users/me/', {
        headers: { 'Authorization': 'Token ' + token }
    });

    if (response.ok) {
        const user = await response.json();
        renderProfile(user);
    } else {
        document.getElementById('profile-details').innerHTML = '<p class="col-span-2 text-red-500 font-semibold">Erro ao carregar perfil.</p>';
    }
}

function renderProfile(user) {
    const container = document.getElementById('profile-details');
    container.innerHTML = `
      <div><span class="font-semibold text-gray-900">CPF:</span> ${user.cpf}</div>
      <div><span class="font-semibold text-gray-900">Email:</span> ${user.email}</div>
      <div><span class="font-semibold text-gray-900">Nome:</span> ${user.name || '-'}</div>
      <div><span class="font-semibold text-gray-900">Telefone:</span> ${user.phone || '-'}</div>
      <div><span class="font-semibold text-gray-900">Endereço:</span> ${user.address || '-'}</div>
      <div><span class="font-semibold text-gray-900">CEP:</span> ${user.zipcode || '-'}</div>
      <div><span class="font-semibold text-gray-900">Cidade:</span> ${user.city || '-'}</div>
      <div><span class="font-semibold text-gray-900">Estado:</span> ${user.state || '-'}</div>
      <div><span class="font-semibold text-gray-900">Data de Nascimento:</span> ${user.birth_date || '-'}</div>
      <div><span class="font-semibold text-gray-900">Gênero:</span> ${user.gender || '-'}</div>

    `;
}

document.addEventListener('DOMContentLoaded', () => {
    if (!token) {
        window.location.href = '/login/';
    } else {
        fetchProfile();
    }
});
</script>

{% endblock %}
